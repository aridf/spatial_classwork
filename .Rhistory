library("rnaturalearthdata")
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected))
US <- st_read("gz_2010_us_050_00_20m.shp")
ohio <- US[US$STATE == '39',]
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
library(ggplot2)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
library(sf)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
library(tidyverse)
library(ggplot2)
theme_set(theme_bw())
library(sf)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected))
US <- st_read("gz_2010_us_050_00_20m.shp")
ohio <- US[US$STATE == '39',]
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
pltot(st_geometry(ohio))
plot(st_geometry(ohio))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
ggplot() +
geom_sf(data = ohio) +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
plot(st_geometry(ohio))
ggplot() +
geom_sf(data = ohio) +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred", alpha)
ggplot(data = ohio) +
geom_sf()
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred"
)
View(US)
View(ohio_cities_sf)
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected)) %>%
filter(prop_affected > 0.01)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected)) %>%
filter(prop_affected > 0.01)
f <- tempfile()
US <- st_read("gz_2010_us_050_00_20m.shp")
ohio <- US[US$STATE == '39',]
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 23, fill = "darkred")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, fill = "darkred")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, fill = "darkred", aes(size = prop_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, color = "darkred", aes(size = prop_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, color = "darkred",
aes(size = prop_affected), alpha = 0.75)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected)) %>%
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected))
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
filter(!is.na(prop_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, color = "darkred",
aes(size = prop_affected), alpha = 0.75)
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 20, color = "darkred",
aes(size = prop_affected), alpha = 0.75)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 1, color = "darkred",
aes(size = prop_affected), alpha = 0.75)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 16, color = "darkred",
aes(size = prop_affected), alpha = 0.75)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
mutate(layoff = ifelse(is.na(prop_affected), 0, 1))
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ohio_cities_sf
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 16,
aes(size = prop_affected, color = layoff), alpha = 0.75)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 16,
aes(size = prop_affected), alpha = 0.75)
?recode
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
mutate(layoff = ifelse(is.na(prop_affected), 0, 1)) %>%
recode(prop_affected, NA = 0)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
mutate(layoff = ifelse(is.na(prop_affected), 0, 1)) %>%
recode(prop_affected, NA = 0)
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
mutate(layoff = ifelse(is.na(prop_affected), 0, 1))
ohio_cities_sf <- st_as_sf(df, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_cities_sf, shape = 16,
aes(size = prop_affected), alpha = 0.75)
#split data into laid off and non-laid off cities
ohio_yes <- df[which(layoff == 1),]
ohio_no <- df[which(layoff == 0),]
ohio_yes_sf <- st_as_sf(ohio_yes, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ohio_no_sf <- st_as_sf(ohio_no, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
#split data into laid off and non-laid off cities
ohio_yes <- df[which(df$layoff == 1),]
ohio_no <- df[which(df$layoff == 0),]
ohio_yes_sf <- st_as_sf(ohio_yes, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ohio_no_sf <- st_as_sf(ohio_no, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 0.75)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected))
View(ohio_yes_sf)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = num_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, color='maroon', aes(size = num_affected))
cities <- tibble::tribble(
~ lon,    ~ lat,    ~ name,      ~ pop,
5.121420, 52.09074, "Utrecht",   311367,
6.566502, 53.21938, "Groningen", 189991,
4.895168, 52.37022, "Amsterdam", 779808
) %>% sf::st_as_sf(coords = c("lon", "lat"), crs = 4326)
rm(list=ls())
cities <- tibble::tribble(
~ lon,    ~ lat,    ~ name,      ~ pop,
5.121420, 52.09074, "Utrecht",   311367,
6.566502, 53.21938, "Groningen", 189991,
4.895168, 52.37022, "Amsterdam", 779808
) %>% sf::st_as_sf(coords = c("lon", "lat"), crs = 4326)
lines_sfc <- sf::st_sfc(list(
sf::st_linestring(rbind(cities$geometry[[1]], cities$geometry[[2]])),
sf::st_linestring(rbind(cities$geometry[[2]], cities$geometry[[3]]))
))
lines <- sf::st_sf(
id = 1:2,
size = c(10,50),
geometry = lines_sfc,
crs = 4326
)
ggplot() +
geom_sf(aes(size = pop), data = cities) +
geom_sf(aes(colour = size), data = lines)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, color='maroon', aes(size = num_affected))
library(tidyverse)
library(ggplot2)
theme_set(theme_bw())
library(sf)
df <- read_csv('a3/ohio_clean.csv')
city_lookup <- read_csv('a3/city_populations.csv')
city_lookup$asciiname <- tolower(city_lookup$asciiname)
colnames(city_lookup) <- c('city', 'pop2019', 'location')
df <- df %>% arrange(desc(num_affected))
df_city <- df %>%
group_by(city) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('city', 'num_affected') %>%
arrange(desc(num_affected))
df_county <- df %>%
group_by(county) %>%
summarise(sum(num_affected, na.rm = T)) %>%
set_names('county', 'num_affected')
df <- merge(city_lookup, df_city, all.x = T)
df$prop_affected <- df$num_affected / df$pop2019
df <- df %>% arrange(desc(df$prop_affected))
head(df %>% select(-location))
df <- df %>%
separate_rows(location, sep = '=|,') %>%
group_by(city) %>%
slice(2:3) %>%
mutate('dim' = c('lat', 'long')) %>%
pivot_wider(names_from = 'dim', values_from = location) %>%
mutate(long = as.double(long), lat = as.double(lat)) %>%
mutate(layoff = ifelse(is.na(prop_affected), 0, 1))
#f <- tempfile()
#download.file("http://www2.census.gov/geo/tiger/GENZ2010/gz_2010_us_050_00_20m.zip", destfile = f)
#unzip(f, exdir = ".")
US <- st_read("gz_2010_us_050_00_20m.shp")
ohio <- US[US$STATE == '39',]
#split data into laid off and non-laid off cities
ohio_yes <- df[which(df$layoff == 1),]
ohio_no <- df[which(df$layoff == 0),]
ohio_yes_sf <- st_as_sf(ohio_yes, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ohio_no_sf <- st_as_sf(ohio_no, coords = c('long', 'lat'),
crs = 4326, agr = "constant")
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, color='maroon', aes(size = num_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 1, color='maroon', aes(size = num_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 2, color='maroon', aes(size = num_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = num_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected))
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected),
show.legend = 'point')
dev.off()
tiff('a3/plot1.tiff', units = 'in', width = 5, height = 5, res = 1080)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='grey', alpha = 1) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected),
show.legend = 'point')
dev.off()
tiff('a3/plot1.tiff', units = 'in', width = 5, height = 5, res = 1080)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.5) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected),
show.legend = 'point')
dev.off()
tiff('a3/plot1.tiff', units = 'in', width = 5, height = 5, res = 1080)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.25) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected),
alpha = 0.5, show.legend = 'point')
dev.off()
tiff('a3/plot1.tiff', units = 'in', width = 5, height = 5, res = 1080)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.25) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = prop_affected),
alpha = 0.75, show.legend = 'point')
dev.off()
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.25) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = num_affected),
alpha = 0.75, show.legend = 'point')
tiff('a3/plot1.tiff', units = 'in', width = 5, height = 5, res = 1080)
ggplot(data = ohio) +
geom_sf() +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.25) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = num_affected),
alpha = 0.75, show.legend = 'point')
dev.off()
ggplot(data = ohio) +
geom_sf(aes(fill = population)) +
geom_sf(data = ohio_no_sf, shape = 20, color='black', alpha = 0.25) +
geom_sf(data = ohio_yes_sf, shape = 20, color='maroon', aes(size = num_affected),
alpha = 0.75, show.legend = 'point')
ohio
